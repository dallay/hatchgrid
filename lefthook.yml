# @file lefthook.yml
# @ref https://evilmartians.github.io/lefthook/

pre-commit:
  parallel: true
  commands:
    d_lychee_link_check:
      run: lychee --no-progress --exclude-path node_modules --exclude-path public/admin ./**/*.md
    e_pnpm_check:
      run: pnpm run check
    f_generate_structure_docs:
      run: ./scripts/generate-structure-docs.sh
    g_kotlin_static_analysis:
      run: ./gradlew detektAll
    h_check_secrets:
      run: ./scripts/check-secrets.sh
    i_changed_files_summary:
      run: git diff --name-only --cached

commit-msg:
  parallel: true
  commands:
    a_lint:
      run: npx commitlint --edit

pre-push:
  commands:
    a_frontend_test:
      run: pnpm run test
    b_backend_test:
      run: ./gradlew test
    c_dependency_audit:
      run: pnpm audit || true && ./gradlew dependencyCheckAnalyze || true
    d_build_check:
      run: pnpm run build && ./gradlew build
    e_liquibase_check:
      run: ./gradlew updateSQL --dry-run
